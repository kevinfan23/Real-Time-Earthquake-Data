<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        
        <title>EARTHQUAKE!</title>
        <meta name="description" content="Earthquake data." />
        
        <!-- Open Graph -->
        <meta property="og:title" content="Earthquakes keep happening." />
        <meta property="og:site_name" content="Daily Bruin Online Intern training." />
        
        <!-- CSS -->
        <link href="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/css/foundation.css" rel="stylesheet" type="text/css">
		<link rel="stylesheet" type="text/css" href="css/style.css">        
		<!-- JavaScript -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.3/handlebars.js"></script>

        <script>
	      
            // execute once my page is loaded
            $(document).ready(function(){

                // make the ajax request
                $.ajax({
                    url: "http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/1.0_day.geojson"
					
                // process_data is a callback function, the result of the data 
                // is automatically passed in as an argument
                }).done(process_data);
            });

            function process_data(json_data) {
	            var locations = [];
	            var cities = [];
	            var places = [];
	            var magnitudes = [];
	            
	            for (i = 0; i < json_data.features.length; i++) {
	            	locations[i] = json_data.features[i]['properties']['place'];
	            	cities[i] = locations[i].split(' of ');
	            	places[i] = cities[i][1].split(', ')[0];
	            	magnitudes[i] = json_data.features[i]['properties']['mag'];
	            }
                
                console.log(locations);
                console.log(cities);
                console.log(places);
                console.log(magnitudes);
                
                var source = $("#entry-template").html();
                var template = Handlebars.compile(source);

                var i = 0;
                window.setInterval(function(){

                    var context = {location: locations[i], place: places[i], magnitude: magnitudes[i]};
                    var html = template(context);
                    $("#earthquake-data").html(html);

                    if (magnitudes[i] <= 2) {
                        $("#earthquake-data i").html("peaceful");
                    }
                    else if (magnitudes[i] >= 2 && magnitudes[i] <= 5) {
                        $("#earthquake-data i").html("shaking");
                    }
                    else {
                        $("#earthquake-data i").html("earthquaking");
                    }

                    i++;
                    if(i === locations.length) {
                        window.clearInterval(i);
                    }
                }, 2000);
                
            }
        

        </script>
        
        <script id="entry-template" type="text/x-handlebars-template">
	        <h1>{{place}}</h1>
            <h1>it's<br>
            <img src="./img/bar.png">fucking<br>
            <i>earthquaking</i><br>
			now.                                  
            </h1>
	        <p>{{magnitude}} degree earthquake {{location}}</p>
	    </script>
	    
		<script src="js/main.js"></script>

    </head>
    <body>
        <div class="container">
            <div id="earthquake-data">
            </div>
        </div>
    </body>
</html>